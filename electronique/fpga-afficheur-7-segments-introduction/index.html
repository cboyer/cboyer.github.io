<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="HandheldFriendly" content="True">
  <title>FPGA et afficheur 7 segments: introduction - C. Boyer</title>
  <meta name="description" content="Pilotage d’un afficheur 7 segments avec un FPGA et Verilog." />
  <meta name="author" content="C. Boyer" />
  <meta name="keywords" content="fpga, afficheur, led, verilog" />
  <link rel="canonical" href="https://cboyer.github.io/electronique/fpga-afficheur-7-segments-introduction" />
  <meta property="og:title" content="FPGA et afficheur 7 segments: introduction - C. Boyer" />
  <meta property="og:locale" content="fr_CA" />
  <meta property="og:description" content="Pilotage d’un afficheur 7 segments avec un FPGA et Verilog." />
  <meta property="og:site_name" content="cboyer.github.io" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="2018-11-01T18:08:32-04:00" />
  <meta property="article:published_time" content="2018-04-20T15:32:12-04:00" />
  <meta property="article:modified_time" content="2018-11-01T18:08:32-04:00" />
  <meta name="generator" content="pandoc" />
  <meta name="robots" content="index,follow">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <link href="https://cboyer.github.io/atom.xml" rel="alternate" type="application/atom+xml" />
  <link rel="stylesheet" type="text/css" href="../../style.css" />

  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
  </style>
</head>
<body>
  <div id="container">
    <div id="links">
      <a href="../../rechercher.html" class="search" title="Rechercher">
          <svg class="button" aria-labelledby="search-icon" role="img" viewBox="5 5 21 21" xmlns="http://www.w3.org/2000/svg">
            <title id="search-icon">Rechercher</title>
            <path d="M27 24.57l-5.647-5.648a8.895 8.895 0 0 0 1.522-4.984C22.875 9.01 18.867 5 13.938 5 9.01 5 5 9.01 5 13.938c0 4.929 4.01 8.938 8.938 8.938a8.887 8.887 0 0 0 4.984-1.522L24.568 27 27 24.57zm-13.062-4.445a6.194 6.194 0 0 1-6.188-6.188 6.195 6.195 0 0 1 6.188-6.188 6.195 6.195 0 0 1 6.188 6.188 6.195 6.195 0 0 1-6.188 6.188z"/>
          </svg>
      </a>
      <a href="https://github.com/cboyer" class="github" title="GitHub" target="_blank">
          <svg class="button" aria-labelledby="github-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title id="github-icon">GitHub</title>
            <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path>
          </svg>
      </a>
      <a href="../../atom.xml" class="rss" title="Flux Atom">
          <svg class="button" aria-labelledby="atom-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title id="atom-icon">Flux Atom</title>
            <path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"></path>
          </svg>
      </a>
    </div>

    <h1>cboyer.github.io</h1>

    <ul class="menu">
      <li class="menu_item"><a href="../../index.html">Publications</a></li>
      <li class="menu_item"><a href="../../linux.html">Linux</a></li>
      <li class="menu_item active"><a href="../../electronique.html">Électronique</a></li>
      <li class="menu_item"><a href="../../apropos.html">À propos</a></li>
    </ul>

<article>
<header id="title-block-header">
<h2 class="title">FPGA et afficheur 7 segments: introduction</h1>
 <span class="author">C. Boyer</span>,   <span class="date">2018-04-20 15:32:12 (UTC-04:00)</span>
</header>
<p>[ Partie 1 | <a href="../fpga-afficheur-7-segments-compteur-unique/">Partie 2</a> | <a href="../fpga-afficheur-7-segments-compteurs-multiples/">Partie 3</a> ]</p>
<p>Dans cette article nous verrons comment piloter un afficheur 7 segments avec un FPGA. L’objectif étant purement pédagogique, il s’agit ici d’un exercice visant la mise en pratique de Verilog pour la description d’un circuit logique simple dont le fonctionnement peut s’observer facilement avec un afficheur 7 segments.</p>
<p>Le soin est laissé au lecteur d’avoir l’équipement et l’environnement de développement fonctionnel. À titre indicatif, cet article a été rédigé en utilisant un FPGA Cyclone IV EP4E22E22C8N d’Altera avec Quartus Prime 17.1.0 Lite sous Linux (Fedora 27). Les codes Verilog proposés fonctionneront parfaitement pour d’autres FPGA et environnements tels que Xilinx ou encore Lattice. L’afficheur 7 segments provient d’un vieux décodeur TV Vidéotron, son circuit nous est pour le moment complètement inconnu ce qui implique de faire un peu de rétro-ingénierie même s’il y a fort à parier que le schéma soit disponible sur Internet.</p>
<h2 id="circuit-de-lafficheur-7-segments">Circuit de l’afficheur 7 segments</h2>
<p>Pour utiliser un afficheur 7 segments, nous devons d’abord nous attarder sur le fonctionnement de celui-ci. Il s’agit d’un ensemble de diodes électroluminescentes (DEL ou LED en anglais) disposées de façon à pouvoir représenter un chiffre entre 0 et 9 ainsi que certaines lettres. La principale caractéristique d’une diode est qu’elle ne laisse passer le courant que dans un seul sens : de l’anode (pôle positif) vers la cathode (pole négatif). Les diodes électroluminescentes ont la particularité d’émettre un rayonnement lumineux lorsqu’elles sont traversées par un courant électrique.</p>
<p><img src="7segments.jpg" alt="Afficheur 7 segments" /> <img src="7segments_back.jpg" alt="Arrière de l’afficheur 7 segments" /></p>
<p>Nous avons donc à faire à un composant polarisé: ceci implique de différencier l’anode de la cathode pour chaque segments afin d’établir le schéma de l’afficheur et être en mesure de le faire fonctionner. Commençons par établir une nomenclature des broches de l’afficheur:</p>
<figure>
<img src="7segments_schema.jpg" alt="Schéma" /><figcaption>Schéma</figcaption>
</figure>
<p>Déterminons les paires de broches permettant d’activer chaque segment. Pour cela nous allons procéder par essai/erreur en appliquant une faible tension (1V suffira) depuis un multimètre ou une autre source de faible intensité comme le FPGA avec ses broches VCC et GND. Une plaque de prototypage avec des câbles Dupont est recommandée pour cette étape ainsi que pour connecter le FPGA à l’afficheur.</p>
<p>Nous prendrons en note chacun de nos essais afin de nous assurer de tester toutes les combinaisons de broches et leur polarité. Dès qu’un segment s’allume, nous annoterons sur le schéma les broches correspondantes. Pour respecter le sens de déplacement des électrons (du pôle positif vers le pôle négatif) nous adopterons la convention suivante :</p>
<ul>
<li>le premier caractère : anode (pôle positif)</li>
<li>le deuxième caractère : cathode (pôle négatif)</li>
</ul>
<p>Une fois nos tests terminés, nous obtenons le schéma avec les annotations suivantes :</p>
<figure>
<img src="7segments_schema_labels.jpg" alt="Schéma annoté" /><figcaption>Schéma annoté</figcaption>
</figure>
<p>Rappelons que par convention le premier caractère de chaque segment représente l’anode (pôle positif) et le deuxième la cathode (pôle négatif). Le schéma obtenu peut différer de celui des autres afficheurs et de celui du lecteur.</p>
<p>Nous sommes maintenant en mesure d’utiliser l’afficheur car nous avons identifié l’anode et la cathode de chaque segment.</p>
<p>On observe que pour chaque afficheur tous les segments possèdent une anode commune. Ainsi le seul moyen de contrôler l’afficheur est d’appliquer une tension sur l’anode (qui est commune) et de relier la cathode des segments voulus à la masse. Par exemple pour afficher le chiffre 3 sur l’afficheur le plus à droite il faut appliquer une tension sur l’anode E et mettre à la masse les cathodes 6, 7, 3, C et D. Ce qui nous donne les segments {E6, E7, E3, EC, ED}.</p>
<p>Ce mode de fonctionnement va poser un problème de taille : un FPGA n’est pas capable de faire office d’interrupteur pour fermer ou ouvrir le circuit, il peu uniquement générer une tension ou non (un 1 ou un 0). Ce problème se poserait également dans le cas d’un afficheur à cathode commune mais dans une moindre mesure: il y aurait seulement 4 cathodes (une par afficheur) à gérer contre 8 dans notre cas (afficheurs à anode commune).</p>
<p>Pour contourner ce problème, nous allons utiliser un transistor à jonction NPN, le 2N3904, pour chaque cathode. Voici notre montage:</p>
<figure>
<img src="schema.jpg" alt="Schéma" /><figcaption>Schéma</figcaption>
</figure>
<figure>
<img src="breadboard.jpg" alt="Montage" /><figcaption>Montage</figcaption>
</figure>
<h2 id="pilotage-dun-afficheur">Pilotage d’un afficheur</h2>
<p>Maintenant que nous connaissons l’anode et la cathode de chaque segment, il va falloir les relier aux broches du FPGA et implémenter la partie logique en Verilog qui permettra d’appliquer une tension ou non sur les segments voulus.</p>
<p>Commençons par définir un module nommé SevenSegment avec pour entrée le signal issu de l’horloge du FPGA (50 MHz) et 9 sorties (1 cathode pour chacun des 7 segments, 1 pour l’anode commune et 1 pour la cathode du point). Nous détaillerons plus tard l’utilité du signal d’horloge.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">/* module */</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">module</span> SevenSegment (</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="dt">input</span> CLOCK_<span class="dv">50</span>,</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">    <span class="dt">output</span> [<span class="dv">8</span>:<span class="dv">0</span>] DISPLAY_<span class="dv">1</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">);</a></code></pre></div>
<p>Remarquons que l’indexation d’un registre vectoriel <code>DISPLAY_1</code> se fait dans le sens inverse des tableaux que l’on retrouve dans des langages tels que le C. Ainsi, l’indice 0 représente la valeur la plus à droite (bit de poids faible) et l’indice 8 la valeur la plus à gauche (bit de poids fort). On pourrait dire qu’un registre vectoriel se lit de gauche à droite. Maintenant que notre module est déclaré, il nous faut un registre capable de stocker 9 bits pour contrôler nos 9 sorties (1 bit par sortie) :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">/* module */</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">module</span> SevenSegment (</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="dt">input</span> CLOCK_<span class="dv">50</span>,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    <span class="dt">output</span> [<span class="dv">8</span>:<span class="dv">0</span>] DISPLAY_<span class="dv">1</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">);</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    <span class="co">/* reg */</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    <span class="co">//Désactive tout par défaut</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    <span class="dt">reg</span> [<span class="dv">8</span>:<span class="dv">0</span>] display_<span class="dv">1</span>_leds = <span class="bn">9&#39;b000000000</span>;</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">    <span class="co">/* assign */</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">0</span>] = display_<span class="dv">1</span>_leds[<span class="dv">0</span>]; <span class="co">//E (anode commune)</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">1</span>] = display_<span class="dv">1</span>_leds[<span class="dv">1</span>]; <span class="co">//1</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">2</span>] = display_<span class="dv">1</span>_leds[<span class="dv">2</span>]; <span class="co">//C</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">3</span>] = display_<span class="dv">1</span>_leds[<span class="dv">3</span>]; <span class="co">//3</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">4</span>] = display_<span class="dv">1</span>_leds[<span class="dv">4</span>]; <span class="co">//4</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">5</span>] = display_<span class="dv">1</span>_leds[<span class="dv">5</span>]; <span class="co">//5 (le point)</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">6</span>] = display_<span class="dv">1</span>_leds[<span class="dv">6</span>]; <span class="co">//6</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">7</span>] = display_<span class="dv">1</span>_leds[<span class="dv">7</span>]; <span class="co">//7</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">8</span>] = display_<span class="dv">1</span>_leds[<span class="dv">8</span>]; <span class="co">//D</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="kw">endmodule</span></a></code></pre></div>
<p>Les assignations registre-sortie vont nous permettre de contrôler l’état des sorties du FPGA en affectant une valeur (0 ou 1) a chaque registre. Il va falloir indiquer à Quartus quelle sortie de notre module <code>DISPLAY_1</code> est assignée à quelle sortie physique du FPGA à l’aide du Pin Planner.</p>
<p>Affichons maintenant le chiffre 0  en activant les sorties reliées aux segments E6, E7, EC, ED, E1 et E4:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">/* module */</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">module</span> SevenSegment (</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="dt">input</span> CLOCK_<span class="dv">50</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="dt">output</span> [<span class="dv">8</span>:<span class="dv">0</span>] DISPLAY_<span class="dv">1</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">);</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="co">/* reg */</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="co">//Désactive tout par défaut</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="dt">reg</span> [<span class="dv">8</span>:<span class="dv">0</span>] display_<span class="dv">1</span>_leds = <span class="bn">9&#39;b000000000</span>;</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    <span class="co">/* assign */</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">0</span>] = display_<span class="dv">1</span>_leds[<span class="dv">0</span>]; <span class="co">//E (anode commune)</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">1</span>] = display_<span class="dv">1</span>_leds[<span class="dv">1</span>]; <span class="co">//1</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">2</span>] = display_<span class="dv">1</span>_leds[<span class="dv">2</span>]; <span class="co">//C</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">3</span>] = display_<span class="dv">1</span>_leds[<span class="dv">3</span>]; <span class="co">//3</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">4</span>] = display_<span class="dv">1</span>_leds[<span class="dv">4</span>]; <span class="co">//4</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">5</span>] = display_<span class="dv">1</span>_leds[<span class="dv">5</span>]; <span class="co">//5 (le point)</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">6</span>] = display_<span class="dv">1</span>_leds[<span class="dv">6</span>]; <span class="co">//6</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">7</span>] = display_<span class="dv">1</span>_leds[<span class="dv">7</span>]; <span class="co">//7</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span>[<span class="dv">8</span>] = display_<span class="dv">1</span>_leds[<span class="dv">8</span>]; <span class="co">//D</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"></a>
<a class="sourceLine" id="cb3-22" data-line-number="22">    <span class="co">/* always */</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23">    <span class="kw">always</span> @ (<span class="kw">posedge</span> CLOCK_<span class="dv">50</span>) <span class="kw">begin</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"></a>
<a class="sourceLine" id="cb3-25" data-line-number="25">        <span class="co">//Active E (anode commune)</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26">        display_<span class="dv">1</span>_leds[<span class="dv">0</span>] &lt;= <span class="bn">1&#39;b1</span>;</a>
<a class="sourceLine" id="cb3-27" data-line-number="27"></a>
<a class="sourceLine" id="cb3-28" data-line-number="28">        <span class="co">//Chiffre 0</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29">        display_<span class="dv">1</span>_leds[<span class="dv">6</span>] &lt;= <span class="bn">1&#39;b1</span>; <span class="co">//Active 6, E6 devient actif</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30">        display_<span class="dv">1</span>_leds[<span class="dv">7</span>] &lt;= <span class="bn">1&#39;b1</span>; <span class="co">//Active 7, E7 devient actif</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31">        display_<span class="dv">1</span>_leds[<span class="dv">2</span>] &lt;= <span class="bn">1&#39;b1</span>; <span class="co">//Active C, EC devient actif</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32">        display_<span class="dv">1</span>_leds[<span class="dv">8</span>] &lt;= <span class="bn">1&#39;b1</span>; <span class="co">//Active D, ED devient actif</span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33">        display_<span class="dv">1</span>_leds[<span class="dv">1</span>] &lt;= <span class="bn">1&#39;b1</span>; <span class="co">//Active 1, E1 devient actif</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34">        display_<span class="dv">1</span>_leds[<span class="dv">4</span>] &lt;= <span class="bn">1&#39;b1</span>; <span class="co">//Active 4, E4 devient actif</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"></a>
<a class="sourceLine" id="cb3-36" data-line-number="36">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37"></a>
<a class="sourceLine" id="cb3-38" data-line-number="38"><span class="kw">endmodule</span></a></code></pre></div>
<p>Il est tout à fait possible de simplifier le code comme suit:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">/* module */</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">module</span> SevenSegment (</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="dt">input</span> CLOCK_<span class="dv">50</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="dt">output</span> [<span class="dv">8</span>:<span class="dv">0</span>] DISPLAY_<span class="dv">1</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">);</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="co">/* reg */</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    <span class="co">//Désactive tout par défaut</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">    <span class="dt">reg</span> [<span class="dv">8</span>:<span class="dv">0</span>] display_<span class="dv">1</span>_leds = <span class="bn">9&#39;b000000000</span>;</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">    <span class="co">/* assign */</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">    <span class="kw">assign</span> DISPLAY_<span class="dv">1</span> = display_<span class="dv">1</span>_leds;</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">    <span class="co">/* always */</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">    <span class="kw">always</span> @ (<span class="kw">posedge</span> CLOCK_<span class="dv">50</span>) <span class="kw">begin</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"></a>
<a class="sourceLine" id="cb4-17" data-line-number="17">        <span class="co">//Chiffre 0</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18">        display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b111010111</span>;</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"></a>
<a class="sourceLine" id="cb4-20" data-line-number="20">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="kw">endmodule</span></a></code></pre></div>
<p>DISPLAY_1 et display_1_leds étant de même taille (9), l’assignation <code>assign DISPLAY_1 = display_1_leds</code> se fait bit à bit. Nous pouvons supprimer l’assignation <code>display_1_leds[0] &lt;= 1'b1</code> (anode commune) car nous avons le contrôle de cette valeur dans 11101011<strong>1</strong> (première valeur de <code>display_1_leds</code>, donc <code>display_1_leds[0]</code>).</p>
<p>En suivant la même logique, on obtient la liste des segments actifs pour afficher respectivement chaque chiffre de 0 à 9 :</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode verilog"><code class="sourceCode verilog"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">//Chiffre 0, segments {ED, E7, E6, E4, EC, E1}</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b111010111</span>;</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">//Chiffre 1, segments {E7, EC}</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b010000101</span>;</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">//Chiffre 2, segments {ED, E7, E6, E3, E1}</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b111001011</span>;</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">//Chiffre 3, segments {ED, E7, E6, E3, EC}</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b111001101</span>;</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">//Chiffre 4, segments {E7, E4, E3, EC}</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b010011101</span>;</a>
<a class="sourceLine" id="cb5-15" data-line-number="15"></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">//Chiffre 5, segments {ED, E6, E4, E3, EC}</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b101011101</span>;</a>
<a class="sourceLine" id="cb5-18" data-line-number="18"></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">//Chiffre 6, segments {ED, E6, E4, E3, EC, E1}</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b101011111</span>;</a>
<a class="sourceLine" id="cb5-21" data-line-number="21"></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">//Chiffre 7, segments {E7, E6, EC}</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b011000101</span>;</a>
<a class="sourceLine" id="cb5-24" data-line-number="24"></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">//Chiffre 8, segments {ED, E7, E6, E4, E3, EC, E1}</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b111011111</span>;</a>
<a class="sourceLine" id="cb5-27" data-line-number="27"></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">//Chiffre 9, segments {ED, E7, E6, E4, E3, EC}</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29">display_<span class="dv">1</span>_leds &lt;= <span class="bn">9&#39;b111011101</span>;</a></code></pre></div>
<p>Nous sommes maintenant en mesure d’afficher n’importe quel chiffre sur notre afficheur 7 segments.</p>
<p>Dans <a href="../fpga-afficheur-7-segments-compteur-unique/">la partie 2</a>, nous irons un peu plus loin en implémentant un compteur pour afficher les chiffres de 0 à 9.</p>
<p>[ Partie 1 | <a href="../fpga-afficheur-7-segments-compteur-unique/">Partie 2</a> | <a href="../fpga-afficheur-7-segments-compteurs-multiples/">Partie 3</a> ]</p>
</article>

<div id="footer">
  <hr />
  <span class="copyrights">© 2018 C. Boyer, contenu sous licence <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.fr">Creative Commons BY-SA-NC 4.0</a>, l'ensemble des codes sources sont sous licence <a href="https://www.gnu.org/licenses/gpl-3.0.fr.html">GNU GPL v3</a>.</span>
</div>

</div>
</body>
</html>
